<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>OOT/OOTMM/AP Spoiler Log to Checklist</title>
    <meta X-Content-Type-Options: nosniff>
    <link rel="icon" type="image/x-icon" href="favicon.ico">

    <link rel="stylesheet" href="mystyle.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">

    <script crossorigin src="logic/items.js" type="module"></script>
    <script type="module" crossorigin src="logic/functions.js"></script>

</head>

<body>

    <div id="HeaderDiv"> 
        <div id="titleDiv">
            <h1>Fridge's Spoiler Log Tracker</h1>
        </div>
        <div id="inputDiv">
            <label for="inputfile" class="label">Upload Your AP/OOTR/OOTMM/SoH Spoiler Log</label>
            <input type="file" name="inputfile" id="inputfile" value="" class="hide">
            <input type="button" value="Browse..." id="inputButton" onclick="document.getElementById('inputfile').click();" />
        </div>
        <div id="errorDiv"></div>
        <div id="infoDiv"></div>
        <div id="randoDet"></div>
    </div>
    
    <hr>

    <div id="buttonDiv">
        <input type="button" id="revealButton" class="button" value="Reveal All" onclick="revealAll()">
        <input type="button" id="hideButton" class="button" value="Hide All" onclick="hideAll()">
        <input type="button" id="topButton" class="button" value="To Top" onclick="document.documentElement.scrollTop = 0">
        <input type="button" id="saveButton" class="button" value="Save" onclick="saveSpoilerState()">
        <input type="button" id="loadButton" class="button" value="Load" onclick="loadSpoilerState()">
        <input type="button" id="dungeonTrackerButton" class="button" value="Dungeons" onclick="toggleDungeonTracker()">
        <input type="text" id="searchInput" placeholder="Find Locations" onkeyup="this.onchange()" onchange="searchLocations(this.value)">
        <div id="inventory"></div>
        
        

    </div>

    <div id="tableDiv"></div>

    <div id="blurDiv1">
        <div id="popupDiv">
            <form action="javascript:slotNameSubmitted(AP_SlotNameInput.value)">
                <h4>Enter your slot name</h4>
                <p>(leave blank for all)</p>
                <input type="text" id="AP_SlotNameInput">
                <input type="submit" id="AP_SlotNameSubmit" value="OK">
            </form>
        </div>
    </div>

    <div id="blurDiv2" onclick="toggleDungeonTracker()"></div>
    <div id="dungeonTracker" onclick=""></div>
    
    

    
    

    <script>
        //import { items } from "logic/items.js";
        //import * as requirements from "logic/functions.js";

        window.onload = function(){
            document.getElementById('searchInput').value = '';
            document.getElementById("popupDiv").style.display = "none";
            if(document.getElementById("inputfile").value != ""){
                main(document.getElementById('inputfile'));
            }
        }

        document.getElementById('inputfile').addEventListener('change', function () {main(this)});

        function main(file){
            let fr = new FileReader();
            fr.onload = function () {
                if(document.getElementById("idTable")){
                    document.getElementById("idTable").remove();
                }
                let localCopy = fr.result;
                let randoVersion = "";
                let seed = "";
                let pos = 0;
                let endpos = 0;
                let randomDungeonOptions = "";

                if (localCopy.search("\":seed_url\":") != -1){
                    randoVersion = "OOTR";
                    //seed retrieval
                    pos = localCopy.search("\":seed\":");
                    let x = localCopy.slice(pos);
                    endpos = x.search(",");
                    x = x.slice(0, endpos);
                    seed = x.split(":")[2].trim();
                    seed = seed.replaceAll(/["]/g, "");

                    //location retrieval
                    pos = localCopy.search("\"locations");
                    endpos = localCopy.search("skipped_locations");
                    localCopy = localCopy.slice(pos, endpos);
                }
                else if(localCopy.search("Location List") != -1){
                    randoVersion = "OOTMM";
                    //seed retrieval
                    pos = 5;
                    endpos = localCopy.search("\n");
                    seed = localCopy.slice(pos, endpos);

                    //location retrieval
                    pos = localCopy.search("Location List");
                    localCopy = localCopy.slice(pos);
                    getStarterItems(fr.result);
                    randomDungeonOptions = getRandomizedDungeons(fr.result);
                }
                else if(localCopy.search("\"locations") != -1){
                    randoVersion = "OOTSHIP";
                    //seed retrieval
                    pos = localCopy.search("\"seed\":");
                    let x = localCopy.slice(pos);
                    endpos = x.search(",");
                    x = x.slice(0, endpos);
                    seed = x.split(":")[1].trim();
                    seed = seed.replaceAll(/["]/g, "");

                    //location retrieval
                    pos = localCopy.search("\"locations");
                    localCopy = localCopy.slice(pos);
                }
                else if(localCopy.search("Archipelago") == 0){
                    randoVersion = "Archipelago";
                    //seed retrieval
                    pos = localCopy.search("Seed") 
                    endpos = localCopy.search("\n");
                    let x = localCopy.slice(pos, endpos);
                    seed = x.split(":")[1].trim();

                    promptSlotName();

                    //location retrieval
                    endpos = localCopy.search("Playthrough:");
                    if (localCopy.split(":")[0] != "Locations"){                            
                        pos = localCopy.lastIndexOf("Locations:");
                        localCopy = localCopy.slice(pos, endpos);
                    } 
                }
                else{
                    document.getElementById("errorDiv").innerText = "Invalid File Uploaded";
                    document.getElementById("infoDiv").innerHTML = "";
                    return;
                }
                console.log(seed);

                
                buildTable(localCopy, randoVersion, seed);
                buildDungeonTracker(randoVersion, randomDungeonOptions);
            }
            fr.readAsText(file.files[0]);
        }

        function buildTable(localCopy, randoVersion, seed){

            document.getElementById("randoDet").innerHTML = `<h3>Version: ${randoVersion} </h3>`;
            document.getElementById("infoDiv").innerHTML = `<p>${seed}</p>`;
            document.getElementById("errorDiv").innerText = "";
    
            console.log(randoVersion);
            let locationArray = [];
            let itemArray = [];
            let combineSplits = "";
            let splitedLine = [];
            let group = "";

            localCopy.split('\n').forEach(line => {
                if (randoVersion == "Archipelago"){
                    //split at last instance of :
                    splitedLine = line.split(/:(?!.*:.*)/s);
                }
                else{
                    //split at first instance of :
                    splitedLine = line.split(/:(.*)/s);
                }
                
                if(splitedLine[0].trim() != "\"model\"" && splitedLine[0].trim() != "\"trickName\"" && splitedLine[0].trim() != "\"price\""){
                    locationArray.push(splitedLine[0]);
                    itemArray.push(splitedLine[1]);
                    
                }
            })

            if (randoVersion == "OOTSHIP" || randoVersion == "OOTR"){
                locationArray = sanitizeList(locationArray);
                itemArray = sanitizeList(itemArray);
            }

            let x = document.createElement("TABLE");
            x.setAttribute("id", "idTable");
            document.getElementById("tableDiv").appendChild(x);

            for (let i=0; i<locationArray.length; i++){
                //console.log(locationArray[i]);
                let newRow = document.createElement("TR");
                newRow.classList.add("spoilerLogRow");
                let appendBinary = true;
                let removeBinary = false;
                newRow.setAttribute("id", "row"+i);
                document.getElementById("idTable").appendChild(newRow);

                let newCell1 = document.createElement("TD");
                newCell1.classList.add("locations");
                newCell1.setAttribute("id", "location"+i);

                let newCell2 = document.createElement("TD");
                newCell2.classList.add("items", "itemsHidden");
                newCell2.setAttribute("id", "item"+i);

                if(randoVersion == "OOTR"){
                    if(itemArray[i] === undefined || itemArray[i] == ""){
                        newCell1.innerHTML = locationArray[i];
                    }

                    if (locationArray[i].includes("locations")){
                        locationArray[i] = locationArray[i].charAt(0).toUpperCase() + locationArray[i].slice(1);
                        newCell1.innerHTML = locationArray[i];
                        newCell1.classList.add("locationHeader");
                    }
                    else if(appendBinary){
                        newCell1.innerHTML = `<a href='javascript:void(0)' id='locationLink-${i}' onclick='linkClicked(this.id)'><p>${locationArray[i]}</p></a>`;
                    } 

                    if(itemArray[i].includes("item:")){
                        lengthx = 0;
                        if(itemArray[i].includes("price:")){
                            lengthx = itemArray[i].indexOf("price:") - itemArray[i].indexOf("item:") - 6;
                        }
                        if(itemArray[i].includes("model:")){
                            lengthx = itemArray[i].indexOf("model:") - itemArray[i].indexOf("item:") - 6;
                        }

                        itemArray[i] = itemArray[i].substr(5, lengthx);
                    }
                }

                if (randoVersion == "OOTSHIP"){
                    if (locationArray[i] == "item"){
                        //console.log(itemArray[i]);
                        if (itemArray[i].includes("Ice Trap")){
                            document.getElementById(("item"+(i-1)).toString()).innerHTML = `<a href='javascript:void(0)' id='itemLink-${i-1}' onclick='linkClicked(this.id)'><p>Ice Trap</p></a>`;
                            document.getElementById(("item"+(i-1)).toString()).classList.add("itemsHidden");
                            document.getElementById(("item"+(i-1)).toString()).classList.remove("itemsNull");
                            itemArray[i] = "";
                            appendBinary = false;
                            }
                        else{
                            document.getElementById(("item"+(i-1)).toString()).innerHTML = `<a href='javascript:void(0)' id='itemLink-${i-1}' onclick='linkClicked(this.id)'><p>${itemArray[i]}</p></a>`;
                            document.getElementById(("item"+(i-1)).toString()).classList.add("itemsHidden");
                            document.getElementById(("item"+(i-1)).toString()).classList.remove("itemsNull");
                        }
                        removeBinary = true;
                    }
                
                    if(itemArray[i] === undefined || itemArray[i] == ""){
                        newCell1.innerHTML = locationArray[i];
                    }

                    if (locationArray[i].includes("locations")){
                        locationArray[i] = locationArray[i].charAt(0).toUpperCase() + locationArray[i].slice(1);
                        newCell1.innerHTML = locationArray[i];
                        newCell1.classList.add("locationHeader");
                    }
                    else if(appendBinary){
                        newCell1.innerHTML = `<a href='javascript:void(0)' id='locationLink-${i}' onclick='linkClicked(this.id)'><p>${locationArray[i]}</p></a>`;
                    }  
                
                }
                if (randoVersion == "OOTMM" || randoVersion == "Archipelago"){
                    if(itemArray[i] === undefined || itemArray[i].trim() == ""){
                        newCell1.innerHTML = locationArray[i];
                    }
                    else{
                        newCell1.innerHTML = `<a href='javascript:void(0)' id='locationLink-${i}' onclick='linkClicked(this.id)'><p>${locationArray[i]}</p></a>`;
                    } 
                }
                
                if (randoVersion == "Archipelago"){
                    if(locationArray[i].trim() == ""){
                        removeBinary = true;
                    }
                }

                if(itemArray[i] === undefined || itemArray[i].trim() == ""){
                    itemArray[i] = "";
                    if (randoVersion == "OOTMM" || randoVersion == "Archipelago"){
                        newCell1.classList.add("locationHeader");
                        group = locationArray[i].trim().split(/\s(?!.*\s.*)/s)[0];
                        group = group.replaceAll(" ", "_");
                    }
                    newCell2.classList.add("itemsNull");
                }

                if(locationArray[i].trim() == "" && itemArray[i].trim() == ""){
                        removeBinary = true;
                    }

                if(appendBinary){
                    if(randoVersion == "OOTMM" && !removeBinary){
                        newCell1.classList.add(group);
                    }
                    newCell2.innerHTML = `<a href='javascript:void(0)' id='itemLink-${i}' onclick='linkClicked(this.id)'><p>${itemArray[i]}</p></a>`
                    document.getElementById("row"+i).appendChild(newCell1);
                    document.getElementById("row"+i).appendChild(newCell2);
                }

                if (!document.getElementById("row"+i).hasChildNodes() || removeBinary){
                    document.getElementById("row"+i).remove();
                }
            }    
        }

        function linkClicked(id){
            let x = id.substr(id.search("-")+1);
            let y = document.getElementById("item"+x);

            if(y.classList.contains("itemsHidden")){
                y.classList.add("itemsRevealed");
                y.classList.remove("itemsHidden");
                handleInventory(y.innerText, "add");
            }
            else if(y.classList.contains("itemsRevealed")){
                y.classList.add("itemsHidden");
                y.classList.remove("itemsRevealed");
                handleInventory(y.innerText, "remove");
            }

        }

        function revealAll(){
            let x = document.getElementsByClassName("itemsHidden");
            while(x.item(0) != undefined){
                x.item(0).classList.add("itemsRevealed");
                x.item(0).classList.remove("itemsHidden");
            }
        }

        function hideAll(){
            let x = document.getElementsByClassName("itemsRevealed");        
            while(x.item(0) != undefined){
                x.item(0).classList.add("itemsHidden");
                x.item(0).classList.remove("itemsRevealed");
            }
        }

        function sanitizeList(listx){
            for(let i=0; i<listx.length; i++){
                if(listx[i] != undefined){
                    listx[i] = listx[i].trim();
                    listx[i] = listx[i].replaceAll(/[.,"'*+?^${}|\\]/g, "");
                }
                else{
                    listx[i]= "";
                }
            }
            return listx;
        }

        function searchLocations(inputStr){
            let searchText = inputStr.toLowerCase().trim().split(" ");
            if(searchText == null){
                return;
            }
            else{
                //console.log(searchText);
                let displayRow = true;
                let locationClassName = "";
                let rows = document.getElementsByClassName("spoilerLogRow");
                let locations = document.getElementsByClassName("locations");
                console.log(locations.length);
                for(let i=0; i<locations.length; i++){
                    displayRow = true;
                    locationClassName = locations[i].classList[(locations[i].classList.length - 1)].toLowerCase();

                    searchText.forEach((el) => {
                        if (!locations[i].innerText.toLowerCase().includes(el) && !locationClassName.includes(el)){
                            //console.log("inside if statement");
                            displayRow = false;
                            if(locations[i].classList.contains("locationHeader")){
                                displayRow = true;
                            }
                        }
                    });

                    if(displayRow){
                        rows[i].style.display = "";
                    }
                    else{
                        rows[i].style.display = "none";
                    }
                }
            }
        }

        function saveSpoilerState(){
            let localFile = [];
            let seed = document.getElementById("infoDiv").innerText;
            let x = document.querySelectorAll("td.items");
            for(i=0; i<x.length; i++){
                if (x[i].classList.contains("itemsHidden")){
                    localFile.push(0);
                }
                if (x[i].classList.contains("itemsRevealed")){
                    localFile.push(1);  
                }
            }
            localStorage.setItem(seed, JSON.stringify(localFile));
        }

        function loadSpoilerState(){
            let seed = document.getElementById("infoDiv").innerText;
            let spoilerState = JSON.parse(localStorage.getItem(seed));
            if (spoilerState === null){
                return;
            }
            let x = document.getElementsByClassName("items");
            for(let i=0; i<x.length; i++){
                if(spoilerState[i] == 0){
                    if(!x[i].classList.contains("itemsHidden")){
                        x[i].classList.add("itemsHidden");
                        x[i].classList.remove("itemsRevealed");
                    }
                }
                else if(spoilerState[i] == 1){
                    if(!x[i].classList.contains("itemsRevealed")){
                        x[i].classList.add("itemsRevealed");
                        x[i].classList.remove("itemsHidden");
                    }
                }
                else{
                    console.log("spoiler state was neither 1 or 0")
                }
            }
        }

        function getRandomizedDungeons(log){
            /*
            erBoss: none/own game/full
            erDungeons: none/own game/full
            erMajorDungeons: true/false
            erMinorDungeons: true/false
            erGanonCastle: true/false
            erGanonTower: true/false
            erMoon: true/false (this is clock tower option)
            erSpiderHouses: true/false
            erPirateFortress: true/false
            erBeneathWell: true/false
            erIkanaCastle: true/false
            erSecretShrine: true/false
            soulsBossOot: true/false
            soulsBossMm: true/false
            */

            const searchParameters = ["erBoss","erDungeons","erMajorDungeons","erMinorDungeons","erGanonCastle","erGanonTower",
                "erMoon","erSpiderHouses","erPirateFortress","erBeneathWell","erIkanaCastle","erSecretShrine", "soulsBossOot", 
                "soulsBossMm"];

            let dungeonOptions = {};

            let x = 0;

            for(let i = 0; i < searchParameters.length; i++){
                let startPos = log.search(searchParameters[i]);
                let endPos = log.indexOf("\n", startPos); /// THIS SOLVES THE LOOKING FOR END OF LINE PROBLEM !!!

                x = log.slice(startPos, endPos).trim();
                //console.log(x);
                
                let y = x.split(":");
                Object.defineProperty(dungeonOptions, y[0], {value:y[1].trim()});
                  
            }
            console.log("the dungeon options are:")
            console.log(dungeonOptions);

            return(dungeonOptions);
        }

        function buildDungeonTracker(randoVersion, dungeonOptions){
            /*
                so the idea here is that the table goes "dungeon entrance" > leads to "dungeon" > has "boss" > has "reward"
                if the dungeon doesnt have a boss and a reward, don't display either of those cells.
            */
            if(randoVersion != "OOTMM"){
                return;
            }

            //this deletes an old table if an a new file is uploaded without refreshing
            if(document.getElementById("dungeonTable")){
                document.getElementById("dungeonTable").remove();
            }
                        
            /// Sets up the dungeons from the options ///////////////////////////////////
            let dungeonsList = [];

            if(dungeonOptions.erMajorDungeons == "true"){
                //console.log("this works");
                dungeonsList.push("Deku Tree", "Dodongo's Cavern", "Jabu-Jabu's Belly", "Forest Temple", 
                "Fire Temple", "Water Temple", "Shadow Temple", "Spirit Temple");
            }
            if(dungeonOptions.erMinorDungeons == "true"){
                dungeonsList.push("Bottom of the Well", "Ice Cavern", "Gerudo Training Grounds");
            }
            if(dungeonOptions.erGanonCastle == "true"){
                dungeonsList.push("Ganon's Castle");
            }
            if(dungeonOptions.erGanonTower == "true"){
                dungeonsList.push("Ganon's Tower");
            }
            if(dungeonOptions.erMajorDungeons == "true"){
                dungeonsList.push("Woodfall Temple", "Snowhead Temple", "Great Bay Temple", "Stone Tower Temple", "Inverted Stone Tower Temple");
            }
            if(dungeonOptions.erSpiderHouses == "true"){
                dungeonsList.push("Swamp Spider House", "Ocean Spider House");
            }
            if(dungeonOptions.erPirateFortress == "true"){
                dungeonsList.push("Pirate's Fortress");
            }
            if(dungeonOptions.erBeneathWell == "true"){
                dungeonsList.push("Beneath The Well Front", "Beneath The Well Back");
            }
            if(dungeonOptions.erIkanaCastle == "true"){
                dungeonsList.push("Ikana Castle");
            }
            if(dungeonOptions.erSecretShrine == "true"){
                dungeonsList.push("Secret Shrine");
            }
            if(dungeonOptions.erMoon == "true"){
                dungeonsList.push("Clock Tower");
            }

            let bossList = ["Gohma", "King Dodongo", "Barinade", "Phantom Ganon", "Volvagia", "Morpha", "Bongo Bongo", "Twinrova", "Odolwa", "Goht", "Gyorg", "Twinmold"];

            let dungeonRewardsList = ["Kokiri Emerald", "Goron Ruby", "Zora Sapphire", "Light Medallion", "Forest Medallion",
                "Fire Medallion", "Water Medallion", "Shadow Medallion", "Spirit Medallion", "Odolwa's Remains", "Goht's Remains",
                "Gyorg's Remains", "Twinmold's Remains"
            ];

            let newTable = document.createElement("table");
            newTable.id = "dungeonTable";
            let newRow = document.createElement("tr");
            let cell1 = document.createElement("th");
            cell1.innerText = "Entrance";

            let cell2 = document.createElement("th");
            cell2.innerText = "Leads To";

            let cell3 = document.createElement("th");
            cell3.innerText = "Boss";

            let cell4 = document.createElement("th");
            cell4.innerText = "Reward";

            let cell5 = document.createElement("th");
            cell5.innerText = "Boss Soul";
            
                       
            newRow.classList.add("dungeonTrackerRow");
            newRow.appendChild(cell1);
            newRow.appendChild(cell2);
            newRow.appendChild(cell3);
            newRow.appendChild(cell4);
            if(dungeonOptions.soulsBossOOT == "true" || dungeonOptions.soulsBossMm == "true"){
                newRow.appendChild(cell5);
            }
            newTable.appendChild(newRow);

            
            for(let i=0; i<dungeonsList.length; i++){
                let newRow = document.createElement("tr");
                let labelCell = document.createElement("td");
                let dungeonSelectCell = document.createElement("td");
                let bossSelectCell = document.createElement("td");
                let rewardSelectCell = document.createElement("td");
                let bossSoulCell = document.createElement("td");

                let el1 = document.createElement("select");
                el1.name = `${dungeonsList[i]} Dungeon`;
                el1.id = `dungeon${i}`;
                el1.classList.add("dungeonSelect");
                el1.setAttribute("onchange", "dtHandler(this.id, 'dungeon')");
                el1.innerHTML += `<option value="?????">?????</option>`;
                for(let z=0; z<dungeonsList.length; z++){
                    el1.innerHTML += `<option value="${dungeonsList[z]}">${dungeonsList[z]}</option>`;
                }

                let el2 = document.createElement("label");
                el2.innerText = `${dungeonsList[i]}:`;

                let el3 = document.createElement("select");
                el3.name = `${bossList[i]} Boss`;
                el3.id = `boss${i}`;
                el3.classList.add("bossSelect");
                el3.setAttribute("onchange", "dtHandler(this.id, 'boss')");
                el3.innerHTML += `<option value="N/A" disabled hidden>N/A</option>`;
                el3.innerHTML += `<option value="?????" default>?????</option>`;
                for(let z=0; z<bossList.length; z++){
                    el3.innerHTML += `<option value="${bossList[z]}">${bossList[z]}</option>`;
                }

                let el4 = document.createElement("select");
                el4.name = `${dungeonRewardsList[i]} Reward`;
                el4.id = `reward${i}`;
                el4.classList.add("rewardSelect");
                el4.setAttribute("onchange", "dtHandler(this.id, 'reward')");
                el4.innerHTML += `<option value="N/A" disabled hidden>N/A</option>`;
                el4.innerHTML += `<option value="?????">?????</option>`;
                for(let z=0; z<dungeonRewardsList.length; z++){
                    el4.innerHTML += `<option value="${dungeonRewardsList[z]}">${dungeonRewardsList[z]}</option>`;
                }

                let el5 = document.createElement("input");
                el5.type = "checkbox";
                el5.id = `bossSoul${i}`
                el5.classList.add("bossSoulCheckbox");
                
                newRow.classList.add("dungeonTrackerRow");                
                
                labelCell.appendChild(el2);
                dungeonSelectCell.appendChild(el1);
                bossSelectCell.appendChild(el3);
                rewardSelectCell.appendChild(el4);
                if(dungeonOptions.soulsBossOOT == "true" || dungeonOptions.soulsBossMm == "true"){
                    bossSoulCell.appendChild(el5);
                }

                newRow.appendChild(labelCell);
                newRow.appendChild(dungeonSelectCell);
                newRow.appendChild(bossSelectCell);
                newRow.appendChild(rewardSelectCell);
                if(dungeonOptions.soulsBossOOT == "true" || dungeonOptions.soulsBossMm == "true"){
                    newRow.appendChild(bossSoulCell);
                }
                
                newTable.appendChild(newRow);
            }
            document.getElementById("dungeonTracker").appendChild(newTable);

        }

        function toggleDungeonTracker(){
            
            if(document.getElementById("dungeonTracker").style.visibility == "hidden" || document.getElementById("dungeonTracker").style.visibility == ""){
                document.getElementById("dungeonTracker").style.visibility = "visible";
                document.getElementById("blurDiv2").style.display = "block";
                document.body.classList.add("stopScrolling");
            }
            else{
                document.getElementById("dungeonTracker").style.visibility = "hidden"
                document.getElementById("blurDiv2").style.display = "none";
                document.body.classList.remove("stopScrolling");
            }
        }

        function dtHandler(elid, state){ //state can be "dungeon", "boss", or "reward"
            
            //console.log(elid);

            if (document.getElementById(elid) == null){
                return;
            }

            let hideOption = document.getElementById(elid).options[document.getElementById(elid).selectedIndex].text;
                //console.log(hideOption);
                let selectGroup = "";
                var selectedOptions = [];
                if(state == "dungeon"){
                    selectGroup = document.getElementsByClassName("dungeonSelect");
                }
                else if(state == "boss"){
                    selectGroup = document.getElementsByClassName("bossSelect");
                    selectedOptions.push("N/A");
                }
                else if(state == "reward"){
                    selectGroup = document.getElementsByClassName("rewardSelect");
                    selectedOptions.push("N/A");
                }
                
                for (let a = 0; a<selectGroup.length; a++){
                    if(selectGroup[a].options[selectGroup[a].selectedIndex].value != "?????"){
                        selectedOptions.push(selectGroup[a].options[selectGroup[a].selectedIndex].value);
                    }
                }

                for (let a = 0; a<selectGroup.length; a++){
                    if(document.getElementById(elid).value != "?????"){                       
                        if(selectGroup[a].id != elid){
                            for(let b = 0; b<selectGroup[a].options.length; b++){
                                //console.log(selectGroup[a].options[b]);
                                if(selectGroup[a].options[b].value == hideOption){
                                    selectGroup[a].options[b].hidden = true;
                                    
                                }
                                if(!selectedOptions.includes(selectGroup[a].options[b].value)){
                                    selectGroup[a].options[b].hidden = false;
                                }   
                            }
                        }
                    }      
                }

                //console.log(selectedOptions);

            if(state == "dungeon"){
                let dungeonsWithBosses = ["Deku Tree", "Dodongo's Cavern", "Jabu-Jabu's Belly", "Forest Temple", 
                "Fire Temple", "Water Temple", "Shadow Temple", "Spirit Temple", "Woodfall Temple", "Snowhead Temple",
                "Great Bay Temple", "Inverted Stone Tower Temple", "Ikana Castle"]; 
                
                let x = elid.slice(7, elid.length);
                
                for (let i in dungeonsWithBosses){
                    if (document.getElementById(elid).value == dungeonsWithBosses[i] || document.getElementById(elid).value == "?????"){
                        //need to add something here that unhides the boss or reward option selected if it's changed to N/A
                        
                        document.getElementById(`boss${x}`).disabled = false;
                        document.getElementById(`reward${x}`).disabled = false;
                        document.getElementById(`bossSoul${x}`).disabled = false;

                        if(document.getElementById(`reward${x}`).selectedIndex == 0){
                            document.getElementById(`reward${x}`).selectedIndex = 1;
                        }
                        if(document.getElementById(`boss${x}`).selectedIndex == 0){
                            document.getElementById(`boss${x}`).selectedIndex = 1;
                        }
                        return;
                    }   
                }                

                document.getElementById(`boss${x}`).disabled = true;
                document.getElementById(`boss${x}`).selectedIndex = 0;
                document.getElementById(`reward${x}`).disabled = true;
                document.getElementById(`reward${x}`).selectedIndex = 0;
                document.getElementById(`bossSoul${x}`).disabled = true;
                document.getElementById(`bossSoul${x}`).checked = false; 
                dtHandler(elid, "reward");
                dtHandler(elid, "boss");               
            }
        }

        function getStarterItems(log){
            //Starting Items
            let startPos = log.search("Starting Items") + 14;
            let endPos = log.search("Junk Locations");
            log = log.slice(startPos, endPos).trim();
            //document.getElementById("inventory").innerText = log;

            let startItemArray = [];

            x = log.split("\n").forEach(line => {
                //y = line.split(/:(.*)/s);
                line = line.trim();
                startItemArray.push(line);
            })
            console.log(startItemArray);
            for(let i=0; i<startItemArray.length; i++){
                //console.log(i);
                //console.log(startItemArray);
                a = startItemArray[i].split(/:(?!.*:.*)/s); //removes everything after the colon
                //console.log(a);
                //console.log(startItemArray[i]);
                startItemArray[i] = a[0];
                handleInventory(startItemArray[i], "starter");
                
                
            }
            //console.log("the starter item array length is: " + startItemArray.length);
        }

        function handleInventory(inventoryItem, state){ //state can be add, remove, or starter. starter is a more permanent add.
            
            let itemListQuery1 = "";
            let itemListQuery2 = "";
            let sharedItem = false;

            if (inventoryItem.search("(OoT)") != -1){
                itemListQuery1 = "oot_";
                inventoryItem = inventoryItem.replaceAll(" (OoT)", "");
            }
            else if(inventoryItem.search("(MM)") != -1){
                itemListQuery1 = "mm_";
                inventoryItem = inventoryItem.replaceAll(" (MM)", "");
            }
            else{
                itemListQuery1 = "oot_";
                itemListQuery2 = "mm_";
                sharedItem = true;
            }
            inventoryItem = inventoryItem.trim();
            inventoryItem = inventoryItem.replaceAll(/[.,"'*+?^${}|\\0-9]/g, "");
            inventoryItem = inventoryItem.replaceAll(/\s/g, "_");

            itemListQuery1 += inventoryItem; 
            itemListQuery1 = itemListQuery1.replaceAll("__", "_");
            itemListQuery1 = itemListQuery1.toLowerCase();

            if(sharedItem){
                itemListQuery2 += inventoryItem; 
                itemListQuery2 = itemListQuery2.replaceAll("__", "_");
                itemListQuery2 = itemListQuery2.toLowerCase();
            }

            //this checks to see if the property exists. otherwise it would add unecessary properties
            if(items[itemListQuery1] != null){
                if(Number.isInteger(items[itemListQuery1])){
                    switch(state){
                        case "add":
                            items[itemListQuery1] += 1;
                            break;
                        case "remove":
                            items[itemListQuery1] -= 1;
                            break;
                        case "starter": 
                            items.starterItems.push(itemListQuery1);
                            items[itemListQuery1] += 1;
                            break;
                    }
                }
                else{
                    switch(state){
                        case "add":
                            items[itemListQuery1] = true;
                            break;
                        case "remove":
                            items[itemListQuery1] = false;
                            break;
                        case "starter": 
                            items.starterItems.push(itemListQuery1);
                            items[itemListQuery1] = true;
                            break;
                    }
                }
            }
            if(items[itemListQuery2] != null){
                if(Number.isInteger(items[itemListQuery2])){
                    switch(state){
                        case "add":
                            items[itemListQuery2] += 1;
                            break;
                        case "remove":
                            items[itemListQuery2] -= 1;
                            break;
                        case "starter": 
                            items.starterItems.push(itemListQuery2);
                            items[itemListQuery2] += 1;
                            break;
                    }
                }
                else{
                    switch(state){
                        case "add":
                            items[itemListQuery2] = true;
                            break;
                        case "remove":
                            items[itemListQuery2] = false;
                            break;
                        case "starter": 
                            items.starterItems.push(itemListQuery2);
                            items[itemListQuery2] = true;
                            break;
                    }
                }
            }
            //console.log(items);
            displayInventory();
        }        

        function displayInventory(){
            document.getElementById("inventory").innerText = "";
            for (const [key, value] of Object.entries(items)) {
                if (value){
                    if(key == "starterItems"){
                        for(let i=0; i<items.starterItems.length; i++){
                            document.getElementById("inventory").innerText += items.starterItems[i];
                            document.getElementById("inventory").innerText += "\n";
                        }
                    }
                    else{
                        if(document.getElementById("inventory").innerText.search(key) == -1){
                            document.getElementById("inventory").innerText += key;
                            document.getElementById("inventory").innerText += "\n";
                        }
                    }
                }
            }
        }

        function promptSlotName(){
            document.getElementById("popupDiv").style.display = "block";
            document.getElementById("blurDiv1").style.display = "block";
        }

        function slotNameSubmitted(slotName){
            document.getElementById("popupDiv").style.display = "none";
            document.getElementById("blurDiv1").style.display = "none";
            if(slotName.trim() == ""){
                return;
            }
            
            slotName = slotName.toLowerCase();
            slotName = slotName.charAt(0).toUpperCase() + slotName.slice(1);
            console.log(slotName)
            let x = document.querySelectorAll(".locations");
            for(i=1; i<x.length; i++){
                if(!x[i].innerText.includes(`(${slotName})`)){
                    x[i].parentElement.remove();
                }
            }

        }

        var items = {

        //starter item array to not lose them in inventory tracking
            starterItems : [],

        //init oot items
        //items
            oot_deku_stick : 0,
            oot_deku_nuts : 0,
            oot_slingshot : 0,
            oot_bomb_bag : 0,  //max 3
            oot_bombchu : 0,
            oot_boomerang : 0,
            oot_fairy_ocarina : 0,
            oot_ocarina_of_time : 0,
            oot_magic_bean : 0,
            oot_bow : 0,
            oot_fire_arrow : 0,
            oot_ice_arrow : 0,
            oot_light_arrow : 0,
            oot_hookshot : 0,
            oot_longshot : 0,
            oot_hammer : 0,
            oot_lens_of_truth : 0,
            oot_dins_fire : 0,
            oot_farores_wind : 0,
            oot_nayrus_love : 0,
            oot_rutos_letter : 0,
            oot_bottle : 0, //max 3
        //equipment
            oot_kokiri_sword : 0,
            oot_master_sword : 0,
            oot_giants_knife : 0,
            oot_biggorons_sword : 0,
            oot_deku_shield : 0,
            oot_hylian_shield : 0,
            oot_mirror_shield : 0,
            oot_goron_tunic : 0,
            oot_zora_tunic : 0,
            oot_iron_boots : 0,
            oot_hover_boots : 0,
            oot_bullet_bag1 : 0,
            oot_bullet_bag2 : 0,
            oot_quiver1 : 0,
            oot_quiver2 : 0,
            oot_gorons_bracelet : 0,
            oot_silver_gauntlets : 0,
            oot_golden_gauntlets : 0,
            oot_silver_scale : 0,
            oot_golden_scale : 0,
            oot_childs_wallet : 0,
            oot_adults_wallet : 0,
            oot_giants_wallet : 0,
            oot_colossal_wallet : 0,
            oot_stone_of_agony : 0,
            oot_magic_meter1 : 0,
            oot_magic_meter2 : 0,
        //trade quest
            oot_weird_egg : 0,
            oot_zeldas_letter : 0,
            oot_keaton_mask : 0,
            oot_skull_mask : 0,
            oot_spooky_mask : 0,
            oot_bunny_hood : 0,
            oot_mask_of_truth : 0,
            oot_goron_mask : 0,
            oot_zora_mask : 0,
            oot_gerudo_mask : 0,
            oot_pocket_egg : 0,
            oot_pocket_cucco : 0,
            oot_cojiro : 0,
            oot_odd_mushroom : 0,
            oot_odd_potion : 0,
            oot_poachers_saw : 0,
            oot_broken_goron_sword : 0,
            oot_prescription : 0,
            oot_eyeball_frog : 0,
            oot_eyedrops : 0,
            oot_claim_check : 0,
        //dungeon rewards
            oot_kokiris_emerald : 0,
            oot_gorons_ruby : 0,
            oot_zoras_sapphire : 0,
            oot_light_medallion : 0,
            oot_forest_medallion : 0,
            oot_fire_medallion : 0,
            oot_water_medallion : 0,
            oot_shadow_medallion : 0,
            oot_spirit_medallion : 0,
        //songs
            oot_zeldas_lullaby : 0,
            oot_eponas_song : 0,
            oot_sarias_song : 0,
            oot_song_of_time : 0,
            oot_suns_song : 0,
            oot_song_of_storms : 0,
            oot_minuet_of_forest : 0,
            oot_bolero_of_fire : 0,
            oot_serenade_of_water : 0,
            oot_nocturne_of_shadow : 0,
            oot_requiem_of_spirit : 0,
            oot_prelude_of_light : 0,


        //init mm items
        //items
            mm_fairy_ocarina : 0,
            mm_ocarina_of_time : 0,
            mm_heros_bow : 0,
            mm_fire_arrow : 0,
            mm_ice_arrow : 0,
            mm_light_arrow : 0,
            mm_bomb_bag : 0, //max 3
            mm_bombchu : 0,
            mm_deku_stick : 0,
            mm_deku_nuts : 0,
            mm_magic_bean : 0,
            mm_pictograph_box : 0,
            mm_lens_of_truth : 0,
            mm_hookshot : 0,
            mm_great_fairy_sword : 0,
            mm_bottle : 0, //max 6

        //trade items
            mm_moons_tear : 0,
            mm_land_title_deed : 0,
            mm_swamp_title_deed : 0,
            mm_mountain_title_deed : 0,
            mm_ocean_title_deed : 0,
            mm_room_key : 0,
            mm_letter_to_kafei : 0,
            mm_pendant_of_memories : 0,
            mm_letter_to_mama : 0,
        //equipment
            mm_kokiri_sword : 0,
            mm_razor_sword : 0,
            mm_gilded_sword : 0,
            mm_heros_shield : 0,
            mm_mirror_shield : 0,
            mm_child_wallet : 0,
            mm_adult_wallet : 0,
            mm_giant_wallet : 0,
            mm_colossal_wallet : 0,
            mm_quiver1 : 0,
            mm_quiver2 : 0,
            mm_magic_meter2 : 0,
            mm_magic_meter1 : 0,
            mm_bombers_notebook : 0,
        //masks
            mm_postmans_hat : 0,
            mm_all_night_mask : 0,
            mm_blast_mask : 0,
            mm_stone_mask : 0,
            mm_great_fairy_mask : 0,
            mm_deku_mask : 0,
            mm_keaton_mask : 0,
            mm_bremen_mask : 0,
            mm_bunny_hood : 0,
            mm_don_geros_mask : 0,
            mm_mask_of_scents : 0,
            mm_goron_mask : 0,
            mm_romanis_mask : 0,
            mm_circus_leaders_mask : 0,
            mm_kafeis_mask : 0,
            mm_couples_mask : 0,
            mm_mask_of_truth : 0,
            mm_zora_mask : 0,
            mm_kamaros_mask : 0,
            mm_gibdo_mask : 0,
            mm_garos_mask : 0,
            mm_captains_hat : 0,
            mm_giants_mask : 0,
            mm_fierce_deitys_mask : 0,
        //dungeon rewards
            mm_odolwas_remains : 0,
            mm_gohts_remains : 0,
            mm_gyorgs_remains : 0,
            mm_twinmolds_remains : 0,
        //songs
            mm_song_of_time : 0,
            mm_song_of_healing : 0,
            mm_song_of_storms : 0,
            mm_song_of_soaring : 0,
            mm_eponas_song : 0,
            mm_sonata_of_awakening : 0,
            mm_goron_lullaby_intro : 0,
            mm_goron_lullaby : 0,
            mm_new_wave_bossa_nova : 0,
            mm_oath_to_order : 0,

        //oot key counts
            oot_forest_small_keys : 0, //max 5
            oot_forest_boss_key : 0,
            oot_fire_small_keys : 0, //max 8
            oot_fire_boss_key : 0,
            oot_water_small_keys : 0, //max 6
            oot_water_boss_key : 0,
            oot_shadow_small_keys : 0, //max 5
            oot_shadow_boss_key : 0,
            oot_spirit_small_keys : 0, //max 5
            oot_spirit_boss_key : 0,
            oot_ganon_small_keys : 0, //max 2
            oot_ganon_boss_key : 0,
            oot_well_small_keys : 0, //max 3
            oot_gtg_small_keys : 0, //max 9

        //oot skulls
            skulltula_token : 0, //max 100

        //mm key counts
            mm_woodfall_small_keys : 0, //max 1
            mm_snowhead_small_keys : 0, //max 3
            mm_gbt_small_keys : 0, //max 1
            mm_stt_small_keys : 0, //max 4
            mm_woodfall_boss_key : 0,
            mm_snowhead_boss_key : 0,
            mm_gbt_boss_key : 0,
            mm_stt_boss_key : 0,

        //mm fairies
            mm_town_sf: 0,
            mm_woodfall_sf : 0, //max 15
            mm_snowhead_sf : 0, //max 15
            mm_gbt_sf : 0, //max 15
            mm_stt_sf : 0, //max 15

        //mm clocks
            mm_clock_day1: 0,
            mm_clock_day2: 0,
            mm_clock_day3: 0,
            mm_clock_night1: 0,
            mm_clock_night2: 0,
            mm_clock_night3: 0,

        //progressive buffers
            oot_progressive_sword: 0, //max 3
            mm_progressive_sword: 0, //max 3
            oot_progressive_hookshot: 0, //max 2
            oot_progressive_ocarina: 0, //max 2
            mm_progressive_ocarina: 0, //max 2
        };

        


    </script>
</body>

</html>
